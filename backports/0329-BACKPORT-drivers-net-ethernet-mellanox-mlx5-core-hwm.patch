From: Roy Novich <royno@nvidia.com>
Subject: [PATCH] BACKPORT: drivers/net/ethernet/mellanox/mlx5/core/hwmon.c

Change-Id: I7f46e0ab47230eeb73b742a92b3a32c0baa342bf
---
 drivers/net/ethernet/mellanox/mlx5/core/hwmon.c | 17 +++++++++++++++--
 1 file changed, 15 insertions(+), 2 deletions(-)

--- a/drivers/net/ethernet/mellanox/mlx5/core/hwmon.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/hwmon.c
@@ -1,6 +1,9 @@
 // SPDX-License-Identifier: GPL-2.0 OR Linux-OpenIB
 // Copyright (c) 2023, NVIDIA CORPORATION & AFFILIATES. All rights reserved
 
+
+#ifdef HAVE_NIC_TEMPERATURE_SUPPORTED
+
 #include <linux/hwmon.h>
 #include <linux/bitmap.h>
 #include <linux/mlx5/device.h>
@@ -142,14 +145,23 @@ static umode_t mlx5_hwmon_is_visible(con
 }
 
 static int mlx5_hwmon_read_string(struct device *dev, enum hwmon_sensor_types type, u32 attr,
-				  int channel, const char **str)
+				  int channel,
+#ifdef HAVE_HWMON_READ_STRING_CONST_STR
+				  const char **str)
+#else
+				  char **str)
+#endif
 {
 	struct mlx5_hwmon *hwmon = dev_get_drvdata(dev);
 
 	if (type != hwmon_temp || attr != hwmon_temp_label)
 		return -EOPNOTSUPP;
 
-	*str = (const char *)hwmon->temp_channel_desc[channel].sensor_name;
+	*str =
+#ifdef HAVE_HWMON_READ_STRING_CONST_STR
+		(const char *)
+#endif
+		hwmon->temp_channel_desc[channel].sensor_name;
 	return 0;
 }
 
@@ -416,3 +428,4 @@ void mlx5_hwmon_dev_unregister(struct ml
 	mlx5_hwmon_free(hwmon);
 	mdev->hwmon = NULL;
 }
+#endif /* HAVE_NIC_TEMPERATURE_SUPPORTED */
