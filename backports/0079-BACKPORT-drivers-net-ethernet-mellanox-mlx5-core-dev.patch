From: Valentine Fatiev <valentinef@nvidia.com>
Subject: [PATCH] BACKPORT: drivers/net/ethernet/mellanox/mlx5/core/devlink.h

Change-Id: I2e7d8f67b76677d498458b8e2ef0a8a8fd84b564
---
 drivers/net/ethernet/mellanox/mlx5/core/devlink.h | 11 +++++++++++
 1 file changed, 11 insertions(+)

--- a/drivers/net/ethernet/mellanox/mlx5/core/devlink.h
+++ b/drivers/net/ethernet/mellanox/mlx5/core/devlink.h
@@ -6,6 +6,7 @@
 
 #include <net/devlink.h>
 
+#ifdef HAVE_DEVLINK_RESOURCE_SUPPORT
 enum mlx5_devlink_resource_id {
 	MLX5_DL_RES_MAX_LOCAL_SFS = 1,
 	MLX5_DL_RES_MAX_EXTERNAL_SFS,
@@ -13,6 +14,7 @@ enum mlx5_devlink_resource_id {
 	__MLX5_ID_RES_MAX,
 	MLX5_ID_RES_MAX = __MLX5_ID_RES_MAX - 1,
 };
+#endif
 
 enum mlx5_devlink_param_id {
 	MLX5_DEVLINK_PARAM_ID_BASE = DEVLINK_PARAM_GENERIC_ID_MAX,
@@ -25,6 +27,9 @@ enum mlx5_devlink_param_id {
 	MLX5_DEVLINK_PARAM_ID_ESW_MULTIPORT,
 	MLX5_DEVLINK_PARAM_ID_HAIRPIN_NUM_QUEUES,
 	MLX5_DEVLINK_PARAM_ID_HAIRPIN_QUEUE_SIZE,
+#ifndef HAVE_DEVLINK_PARAM_GENERIC_ID_ENABLE_REMOTE_DEV_RESET
+	MLX5_DEVLINK_PARAM_ID_ENABLE_REMOTE_DEV_RESET,
+#endif
 };
 
 struct mlx5_trap_ctx {
@@ -43,6 +48,7 @@ struct mlx5_devlink_trap_event_ctx {
 	int err;
 };
 
+#ifdef HAVE_DEVLINK_TRAP_SUPPORT
 struct mlx5_core_dev;
 void mlx5_devlink_trap_report(struct mlx5_core_dev *dev, int trap_id, struct sk_buff *skb,
 			      struct devlink_port *dl_port);
@@ -51,10 +57,15 @@ int mlx5_devlink_traps_get_action(struct
 				  enum devlink_trap_action *action);
 int mlx5_devlink_traps_register(struct devlink *devlink);
 void mlx5_devlink_traps_unregister(struct devlink *devlink);
+#endif
 
 struct devlink *mlx5_devlink_alloc(struct device *dev);
 void mlx5_devlink_free(struct devlink *devlink);
+#ifdef HAVE_DEVLINK_REGISTER_GET_1_PARAMS
 int mlx5_devlink_params_register(struct devlink *devlink);
+#else
+int mlx5_devlink_params_register(struct devlink *devlink, struct device *pdev);
+#endif
 void mlx5_devlink_params_unregister(struct devlink *devlink);
 int
 mlx5_devlink_ct_action_on_nat_conns_set(struct devlink *devlink, u32 id,
